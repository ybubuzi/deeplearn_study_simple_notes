# 火车运行状态分析 - 深度学习项目说明

## 🎯 项目目标
这个项目的目标是使用深度学习技术分析火车运行日志，自动识别和预测火车的运行状态。

## 📊 数据结构说明

### 原始数据格式
你的 `test.log` 文件包含以下列：
```
序号  记录名称  日期时间  公里标  距离  车站名  信号灯  速度  限速  空挡  前后  管压  其他
```

### 数据示例
```
25    开机      2025-04-14 10:32:44    1206.586   0    棋梓桥   白灯    0    23   非空   后退   0
26    速度变化   2025-04-14 10:33:02    1207.590   200  胜昔桥   绿灯    30   80   非空   前进   340
```

## 🔄 数据处理流程

### 1. 数据清洗
- **数值转换**: 将文本数字转换为真正的数值类型
- **时间解析**: 将时间字符串转换为时间对象
- **缺失值处理**: 填充空值和异常值

### 2. 特征工程
- **标签编码**: 将文字转换为数字
  ```
  信号灯: 红灯→0, 绿灯→1, 黄灯→2
  ```
- **滑动窗口特征**: 计算移动平均和变化率
- **时间特征**: 提取小时、分钟等时间信息

### 3. 状态分类规则
根据业务逻辑，将原始记录分类为以下状态：
- **初始化**: 开机、进入等操作
- **检测状态**: 自检、制动测试
- **停车状态**: 速度为0的停车
- **低速运行**: 0-30 km/h
- **中速运行**: 30-60 km/h  
- **高速运行**: >60 km/h
- **信号状态**: 根据信号灯颜色
- **操作状态**: 按键操作
- **参数变化**: 速度、管压变化

## 🧠 深度学习模型

### LSTM网络结构
```
输入层: (批次大小, 10个时间步, 特征数)
    ↓
LSTM层1: 64个神经元 (学习长期依赖关系)
    ↓
Dropout: 20% (防止过拟合)
    ↓
LSTM层2: 32个神经元 (进一步抽象)
    ↓
Dropout: 20%
    ↓
全连接层: 32个神经元 (特征整合)
    ↓
Dropout: 30%
    ↓
输出层: 状态类别数 (最终分类)
    ↓
Softmax: 转换为概率分布
```

### 为什么选择LSTM？
1. **时序记忆**: 能记住历史信息，适合分析火车运行的连续状态
2. **长期依赖**: 可以学习较长时间跨度的模式
3. **梯度稳定**: 解决了传统RNN的梯度消失问题

## 📈 数据流转过程

### 输入数据转换
```
原始日志 → 清洗 → 特征工程 → 时序序列 → 模型训练
```

### 具体示例
```
原始数据:
记录名称: "速度变化", 速度: 30, 信号灯: "绿灯"

↓ 特征工程

编码后:
记录名称_encoded: 5, 速度: 30, 信号灯_encoded: 1

↓ 时序序列

序列数据 (用前10个时间点预测第11个):
[
  [时间点1的所有特征],
  [时间点2的所有特征],
  ...
  [时间点10的所有特征]
] → 预测时间点11的状态
```

## 🎯 模型训练过程

### 训练参数
- **Epochs**: 30轮 (模型看数据的次数)
- **Batch Size**: 32 (每次处理32个样本)
- **序列长度**: 10 (用过去10个时间点预测)
- **训练/测试比例**: 80%/20%

### 训练监控指标
- **Loss (损失)**: 预测错误程度，越小越好
- **Accuracy (准确率)**: 预测正确比例，越大越好
- **Validation**: 防止过拟合的监控

## 🔮 预测过程

### 输入要求
- 需要连续的10个时间点的数据
- 数据格式必须与训练时一致
- 特征需要经过相同的预处理

### 输出结果
```python
预测状态: "低速运行"
置信度分布:
  初始化: 0.05 (5%)
  低速运行: 0.75 (75%)  ← 最高概率
  中速运行: 0.15 (15%)
  高速运行: 0.05 (5%)
```

## 💻 代码结构说明

### 主要类和方法
```python
class TrainStatusAnalyzer:
    def __init__()              # 初始化分析器
    def load_and_clean_data()   # 加载和清洗数据
    def feature_engineering()   # 特征工程
    def prepare_sequences()     # 准备时序数据
    def build_model()          # 构建LSTM模型
    def train_model()          # 训练模型
    def predict_status()       # 预测状态
    def visualize_results()    # 可视化结果
```

### 关键概念对比

| 概念 | JavaScript类比 | Java类比 | 说明 |
|------|----------------|----------|------|
| DataFrame | 对象数组 | List<Map> | 二维表格数据 |
| numpy数组 | Array | int[] | 多维数组 |
| fit_transform | map() | stream().map() | 数据转换 |
| LSTM | - | - | 特殊的神经网络 |
| epochs | for循环次数 | 循环次数 | 训练轮数 |

## 🚀 运行项目

### 环境要求
```bash
pip install pandas numpy tensorflow scikit-learn matplotlib seaborn
```

### 运行命令
```bash
python train_status_analysis.py
```

### 预期输出
1. 数据加载和清洗信息
2. 特征工程结果
3. 模型训练过程
4. 性能评估结果
5. 可视化图表
6. 预测示例

## 📊 项目成果

### 生成文件
- `train_status_model.h5`: 训练好的模型文件
- 各种可视化图表
- 详细的训练日志

### 应用价值
1. **实时监控**: 可以实时预测火车状态
2. **异常检测**: 识别异常运行模式
3. **维护预测**: 预测设备维护需求
4. **安全保障**: 提前发现安全隐患

## 🔧 进阶优化建议

1. **数据增强**: 收集更多历史数据
2. **特征优化**: 添加更多有意义的特征
3. **模型调优**: 调整网络结构和参数
4. **集成学习**: 结合多个模型提高准确性
5. **实时部署**: 部署到生产环境

这个项目展示了完整的深度学习工作流程，从数据处理到模型部署，是一个很好的学习案例！
